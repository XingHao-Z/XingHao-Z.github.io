---
title: 锁相环的环路带宽和相位裕度
date: 2025-4-29 21:22:30
tags:
 - 锁相环
categories:
 - 1-通信
 - 锁相环
description: 锁相环的环路特性，包括环路带宽，相位裕度的介绍。
mathjax: true
---

# 反馈系统

下图为典型的反馈系统

<img src="image-20250428164904694.png" alt="image-20250428164904694" style="zoom: 50%;" />

开环传递函数（环路增益/开环增益）为：
$$
L(s)=G(s)H(s)
$$
闭环传递函数（闭环增益）：
$$
T(s)=\frac{G(s)}{1+G(s)H(s)}
$$

> 在分析反馈系统时，一般默认：
>
> 1. 开环传递函数 $L(s)$ 的极点数大于零点数。
>    - 在高频段，开环增益随频率上升而降低。
>    - PLL系统一般是极点数大于零点数，因为 VCO 自带一个极点，环路滤波器的极点数一般大于或等于零点数。
>    - 若极点数小于等于零点数，高频处的稳定性非常差。
> 2. 在低频时开环增益  $|L(s)|$ 非常大，且反馈增益 $H(s)$ 不会有奇怪的零极点（后面讨论的情况就直接假设反馈增益没有零极点，因为 PLL 反馈只有分频器，不引入零极点，即为常数）
>    - 在低频段，闭环传递函数趋近于常数$\frac{1}{H(s)}$，从而保证系统稳定性。



开环传递函数和闭环传递函数的幅频特性一般为：

<img src="image-20250429154328285.png" alt="image-20250429154328285" style="zoom: 33%;" />

开环增益主要由$G(s)$决定，在低频时增益非常大，随频率增加逐渐降低。

在低频时，由于$G(s)$非常大，所以闭环增益几乎等于 $\frac{1}{H(s)}$。

这样，由于施加了负反馈，使得系统增益降低了，但特性的平坦部分被拓宽了，增益-频率特性得到了改善。

随着频率增高，$G(s)$ 逐渐减小，当 $|G(s)H(s)|=1$ 时，即开环增益为 0dB 时，闭环增益 $T(s)=\frac{G(s)}{1+G(s)H(s)}$ 也开始明显降低。所以 $|G(s)H(s)|=1$ 时对应的频率为环路带宽。

在小于环路带宽频率之前，闭环增益接近常数，开环增益相位影响不大；在大于环路带宽频率之后，$G(s)$很小，闭环增益 $T(s)=\frac{1}{\frac{1}{G(s)}+H(s)}$ 的分母非常大，闭环增益很小，开环增益相位影响不大。

在接近环路带宽频率处，开环增益 $G(s)H(s)$ 的相位特性对系统稳定性起关键作用。

比如假设开环增益处$G(s)H(s)$的相位为-180°，又因为$|G(s)H(s)|=1$ ，那么$|1+G(s)H(s)|=0$，那么闭环增益就接近无限大，再该频率处系统就会出现震荡，不稳定。

若$G(s)H(s)$的相位为在-120°和-180°之间，那么$|1+G(s)H(s)|<1$，此时闭环增益就大于开环增益，在该频率处就会出现峰值现象。

将环路带宽处的开环增益相位和-180°的差值定义为**相位裕度**。

若相位裕度大于60°，在$|G(s)H(s)|=1$处也不会有峰值。

![](image-20250429210329977.png)

如图为复平面上的表示的 $1+G(s)H(s)$ 和 $G(s)H(s)$，白色的圆为 $|G(s)H(s)|=1$ 的轨迹，灰色的圆为$|1+G(s)H(s)|=1$ 的轨迹。

可以看到在白色圆上，即 $|G(s)H(s)|=1$ 时，若开环增益相位滞后小于120°，即相位裕度大于60°，$|1+G(s)H(s)|>1$，也就是开环增益大于闭环增益，不会出现峰值。

若相位裕度小于60°，$|1+G(s)H(s)|<1$，也就是开环增益小于闭环增益，就会出现峰值现象。

**较大的相位裕度对应较好的系统稳定性，通常希望相位裕度大于45°，理想目标为60°以上。**

下图就为相位裕度小于60°时的开环传递函数和闭环传递函数：

<img src="image-20250429211202143.png" alt="image-20250429211202143" style="zoom: 33%;" />



# 锁相环的传输特性

## 传输函数

![](image-20250427204712328.png)

如图为锁相环的基本框图。

锁相环的前向增益：
$$
G(s)=\frac{K_{d}F(s)K_\mathrm{v}}{s}
$$


反馈增益：
$$
H(s)=\frac{1}{N}
$$


锁相环的开环传递函数（环路增益/开环增益）为：
$$
L(s)=G(s)H(s)=\frac{K_{d}F(s)K_\mathrm{v}}{sN}
$$
闭环传递函数（闭环增益）：
$$
T(s)=\frac{G(s)}{1+G(s)H(s)}
$$


式中：

$K_d$：鉴相器增益，单位：<mark>v/rad</mark>。在数据手册中，为输出误差电压与相位差关系图的斜率，如下图：

<img src="image-20250427213618298.png" alt="image-20250427213618298" style="zoom: 67%;" />

$F(s)$：环路滤波器的传输函数。

$K_\mathrm{v}$：VCO增益，单位：<mark>$\mathrm{rad}/\mathrm{s}\cdot\mathrm{v}$</mark>。在数据手册中，为输出频率与控制电压关系图的斜率**乘以2π**。

$N$：反馈分频比。



## 环路带宽和相位裕度

**环路带宽**：环路增益$L(s)$降为0dB时对应的频率。（环路增益一般随频率增大而降低）（不是环路滤波器的带宽）

**相位裕度**：在环路带宽频率（也就是开环增益$L(s)$降到 0 dB 时的频率）下，开环传递函数$L(s)$相位距离 -180° 还有多少的余量。



## 举例1

如图所示的锁相环结构：

![](image-20250427214837509.png)

- **鉴相器**

  鉴相器的输入输出特性如下：

  <img src="image-20250427215420669.png" alt="image-20250427215420669" style="zoom:75%;" />

  所以鉴相器增益：$K_d=\frac{5}{4\pi}\approx0.398(\mathrm{V/rad})$

- **VCO**

  VCO的输入输出特性如下：

  ![](image-20250427215654248.png)

  输出频率为50KHz，在图中找到50KHz处的斜率，所以VCO的增益：$K_\mathrm{v}=\frac{(58.25-37.53)\times10^3\times2\pi}{2.5-1.5}\approx130.2(\mathrm{rad/s}\cdot\mathrm{V})$

- **环路滤波器**

  环路滤波器结构如下：

  <img src="image-20250427220157668.png" alt="image-20250427220157668" style="zoom:50%;" />

  所以环路滤波器的传输函数：$F(s)=\frac{Z_2+Z_3}{R_2+Z_2+Z_3}$，其中，$Z_2=\frac{1}{sC_2}$，$Z_3=R_3//(\frac{1}{sC_3})=\frac{R_3}{1+sR_3C_3}$

- **分频器**

  反馈分频比为50，所以反馈增益：$H(s)=\frac{1}{50}$
  
  

所以总的环路增益：$L(s)=G(s)H(s)=\frac{K_{d}F(s)K_\mathrm{v}}{sN}$，将以上的值带入，使用MATLAB绘制伯德图如下：

{% hideToggle  MATLAB代码%}

```matlab
s = tf('s');

Kpd = 5/(4*pi);    % 鉴相器增益
Kvco = 2*pi*(58.25e+03-37.53e3) / 1;   % VCO增益
N = 50;		% 反馈分频比

Cs = (Kpd * Kvco) / (s*N);  %除去环路滤波器的开环传输函数，包含PD，VCO，分频器

%% 环路滤波器定义
R2 = 91e3;
C2 = 1.8e-6;
R3 = 10e3;
C3 = 390e-9;

z3 = R3/(s*C3*R3+1);
z2 = 1/(s*C2);

Fs = (z2 + z3) / (R2 + z2 + z3);

%% 
% 开环增益
A = Fs * Cs;

% 闭环传递函数
Hs = A / (1 + A);

%%
f = logspace(-1, 4, 1000);   % Hz
w = 2*pi*f;

% 提取幅频响应和相频响应
[mag, phase] = bode(Hs, w);  

mag = squeeze(mag);    % 拉直
phase = squeeze(phase);

% 绘图
figure;
semilogx(f, 20*log10(mag), 'LineWidth', 1.5);  % 先画幅频
hold on;
yyaxis right;  % 切换到右轴
semilogx(f, phase, '--', 'LineWidth', 1.5);    % 画相频

% 美化
grid on;
xlabel('频率 (Hz)');
yyaxis left;
ylabel('增益 (dB)');
yyaxis right;
ylabel('相位 (deg)');
title('Bode图');
xlim([min(f), max(f)]);
legend('增益 (dB)','相位 (deg)');
```

{% endhideToggle %}

![](image-20250427221513106.png)

从图中可以看到，开环增益为0dB时，对应的频率约为19.4Hz，相位为-131°。所以该PLL的环路带宽为19.4Hz，相位裕度为（180°-131°）=49°，略小于60°

闭环传递函数为：$T(s)=\frac{G(s)}{1+G(s)H(s)}$​，使用MATLAB绘制伯德图如下：

![](image-20250427221929624.png)

因为相位裕度小于60°，所以在环路带宽处，闭环增益会有一个抬升，形成一个鼓包。

## 举例2

<img src="image-20250428125904578.png" alt="image-20250428125904578" style="zoom:50%;" />

- **鉴相器**

  鉴相器增益为：$K_d=\frac{3.3}{2\pi}(\mathrm{V/rad})$

- **VCO**

  VCO增益：$K_{VCO}=\frac{(2\pi\times3\times10^9)}{11}(\mathrm{rad/s}\cdot\mathrm{V})$

  <img src="image-20250428131819121.png" alt="image-20250428131819121" style="zoom:50%;" />

- **环路滤波器**

  环路滤波器结构如下，为有源环路滤波器：

  <img src="image-20250428130121204.png" alt="image-20250428130121204" style="zoom:67%;" />

  传输函数：
  $$
  F(s)=\frac{1+s\cdot T2}{s\cdot T\cdot(1+s\cdot T1)}
  $$
  其中：$T2 = R2 \cdot C2$， $T1 = R3 \cdot C3$， $T = R1 \cdot C2$

  根据需要的环路带宽和相位裕度，该结构可以由以下表格计算电容电阻值：

  <img src="image-20250428130656229.png" alt="image-20250428130656229" style="zoom: 80%;" />

  其中：$\phi$ 为相位裕度，$\omega c$ 为环路带宽（角频率），$\gamma$ 一般为1，$K_V$ 和 $K_{VCO}$ 为鉴相器增益和VCO增益，N 为分频比。

  选择C2和C3的值都为2.2nF。计算得到：R1=154.69K，R2=539.98，R3=38.769。



使用MATLAB计算开环传递函数和闭环传递函数：

开环传递函数的伯德图如下：

![](image-20250428153623707.png)

闭环传递函数的博得图如下：

![](image-20250428153803375.png)





